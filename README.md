# Витрина интернет-магазина

Приложение состоит из подмодулей:

- market-core - это реактивное веб-приложение, предназначенное для поиска, просмотра и заказа товаров.  
Использует Spring Boot, Spring WebFlux, Thymeleaf для шаблонов, базу данных PostgreSQL и Redis для кэша товаров.

- payment - реактивное веб-приложение, предназначенное для управления балансом пользователя.  
Использует Spring Boot и Spring WebFlux.

---

## Требования

- Java 21
- PostgreSQL (рекомендуется версия 17+)
- Redis 7.4+
- Maven 3.6+

---

## Конфигурация

### Настройка подключения к базе данных

Необходимо создать базу данных `my_market` и пользователя с соответствующими правами.

Приложение использует PostgreSQL. Параметры подключения задаются через переменные окружения или значения по умолчанию в `application.yml`:
- `DB_HOST` — адрес сервера базы данных (по умолчанию `localhost`)
- `DB_USERNAME` — имя пользователя PostgreSQL
- `DB_PASSWORD` — пароль пользователя PostgreSQL

### Настройка подключения к Redis

Приложение использует Redis для кэша. Параметры подключения задаются через переменные окружения или значения по умолчанию в `application.yml`:
- `REDIS_HOST` — адрес сервера Redis (по умолчанию `localhost`)

---

## Сборка и размещение приложения

### Сборка JAR файла через Maven

Используется Maven для сборки исполняемого "fat" JAR файла.

### Команды для сборки и деплоя
Соберите подмодули, выполнив команду из корня проекта:
`mvn clean package`

При успешной сборке исполняемый JAR-файл будет автоматически создан в директории target каждого подмодуля.

Запустите JAR-файлы следующей командой, при необходимости указав порт (по умолчанию 8080):
`java -jar <application-name>.jar --server.port=9090`

Доступ к соответствующему приложению будет по адресу:
`http://<host>:<port>/`

### Команды для сборки и запуска в Docker
Создайте Docker-образы, используя команды:  

`docker build -t market-core ./market-core`  
Будет создан образ с именем `market-core` на основе [Dockerfile](market-core/Dockerfile)

`docker build -t payment ./payment`  
Будет создан образ с именем `payment` на основе [Dockerfile](payment/Dockerfile)

Запустите контейнеры, используя команду:  
`docker compose up`  
Будут запущены контейнеры: `postgres`, `redis`, `market-core` и `payment`.  
Конфигурация и внешние порты описаны в [docker-compose.yml](./docker-compose.yml)

Доступ к приложению будет по адресу:
`http://<host>:<port>/`

---

## Тестирование приложения

### Команды для запуска тестов
Запустите тесты командой:
`mvn clean test`

### Загрузка товаров на витрину
Для предварительной загрузки списка товаров на витрину можно использовать [SQL-скрипт](src/test/resources/v1.0.0_00_insert_item.sql)